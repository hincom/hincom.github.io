<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash与V2Ray配置链接</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-all-300 {
                transition: all 300ms ease-in-out;
            }
            .highlight {
                background-color: rgba(59, 130, 246, 0.1);
                border-left: 3px solid #3B82F6;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <!-- 顶部导航 -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-link text-primary text-2xl"></i>
                <h1 class="text-xl md:text-2xl font-bold text-primary">配置链接自动更新</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span id="last-update" class="text-sm text-gray-500 hidden md:inline-block">
                    <i class="fa fa-refresh mr-1"></i>最后更新: 加载中...
                </span>
                <button id="refresh-btn" class="bg-primary hover:bg-primary/90 text-white px-3 py-1.5 rounded-md text-sm flex items-center transition-all-300">
                    <i class="fa fa-refresh mr-1"></i> 刷新
                </button>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- 移动端复制提示 -->
        <div class="bg-blue-50 border border-blue-200 p-3 rounded-md mb-6 md:hidden">
            <p class="text-sm text-blue-700 flex items-center">
                <i class="fa fa-lightbulb-o mr-2"></i>
                提示：长按链接可手动复制，点击复制按钮更快捷
            </p>
        </div>

        <!-- 状态提示 -->
        <div id="status-alert" class="mb-6 p-4 rounded-md bg-blue-50 border border-blue-200 hidden">
            <div class="flex items-start">
                <i class="fa fa-info-circle text-primary mt-0.5 mr-3"></i>
                <p id="status-message" class="text-sm text-blue-700">配置正在加载中...</p>
            </div>
        </div>

        <!-- 选项卡导航 -->
        <div class="mb-6 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px" id="tabs" role="tablist">
                <li class="mr-2" role="presentation">
                    <button id="clash-tab" class="inline-block p-4 border-b-2 border-primary text-primary font-medium" 
                            data-tab="clash-content" role="tab">
                        <i class="fa fa-shield mr-1"></i>Clash URL列表
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button id="v2ray-tab" class="inline-block p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300" 
                            data-tab="v2ray-content" role="tab">
                        <i class="fa fa-random mr-1"></i>V2Ray URL列表
                    </button>
                </li>
                <li role="presentation">
                    <button id="help-tab" class="inline-block p-4 border-b-2 border-transparent hover:text-gray-600 hover:border-gray-300" 
                            data-tab="help-content" role="tab">
                        <i class="fa fa-question-circle mr-1"></i>帮助
                    </button>
                </li>
            </ul>
        </div>

        <!-- 选项卡内容 -->
        <div class="tab-content">
            <!-- Clash URL列表 -->
            <div id="clash-content" class="tab-pane">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">Clash配置URL列表</h2>
                        <button id="copy-clash" class="bg-secondary hover:bg-secondary/90 text-white px-3 py-1.5 rounded-md text-sm flex items-center transition-all-300">
                            <i class="fa fa-copy mr-1"></i> 复制所有URL
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <ul id="clash-list" class="space-y-2 text-sm">
                            <li class="flex items-center p-2 border border-gray-100 rounded hover:bg-gray-50">
                                <i class="fa fa-circle-o-notch fa-spin text-gray-400 mr-3"></i>
                                <span>加载中...</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- V2Ray URL列表 -->
            <div id="v2ray-content" class="tab-pane hidden">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold">V2Ray配置URL列表</h2>
                        <button id="copy-v2ray" class="bg-secondary hover:bg-secondary/90 text-white px-3 py-1.5 rounded-md text-sm flex items-center transition-all-300">
                            <i class="fa fa-copy mr-1"></i> 复制所有URL
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <ul id="v2ray-list" class="space-y-2 text-sm">
                            <li class="flex items-center p-2 border border-gray-100 rounded hover:bg-gray-50">
                                <i class="fa fa-circle-o-notch fa-spin text-gray-400 mr-3"></i>
                                <span>加载中...</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 帮助内容 -->
            <div id="help-content" class="tab-pane hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-lg font-semibold mb-4">复制功能帮助</h2>
                    
                    <div class="mb-6">
                        <h3 class="font-medium text-primary mb-2">如何复制链接？</h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-3 bg-gray-50 rounded-md">
                                <p class="font-medium">方法一：使用复制按钮（推荐）</p>
                                <p>1. 点击每个链接右侧的 <i class="fa fa-copy text-gray-500"></i> 按钮复制单个链接</p>
                                <p>2. 点击列表上方的「复制所有URL」按钮复制全部链接</p>
                            </div>
                            
                            <div class="p-3 bg-gray-50 rounded-md">
                                <p class="font-medium">方法二：手动复制（适用于按钮无法使用时）</p>
                                <p>1. 长按需要复制的链接文本</p>
                                <p>2. 拖动选择框覆盖完整链接</p>
                                <p>3. 点击弹出菜单中的「复制」或「拷贝」选项</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-medium text-primary mb-2">常见问题解决</h3>
                        <div class="space-y-3 text-sm">
                            <div class="p-3 highlight rounded-md">
                                <p class="font-medium">提示"复制失败"怎么办？</p>
                                <p>1. 请尝试使用「手动复制」方法</p>
                                <p>2. 检查浏览器是否处于"无痕模式"，切换到普通模式重试</p>
                                <p>3. 确保浏览器已获得剪贴板权限（手机设置 → 应用管理 → 浏览器 → 权限 → 允许剪贴板）</p>
                            </div>
                            
                            <div class="p-3 bg-gray-50 rounded-md">
                                <p class="font-medium">链接无法加载怎么办？</p>
                                <p>1. 点击页面顶部的「刷新」按钮重试</p>
                                <p>2. 检查网络连接后再试</p>
                                <p>3. 稍后再次访问，链接可能正在更新中</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-6">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>© <span id="current-year"></span> 配置链接自动更新系统</p>
            <p class="mt-1 text-gray-400">最后更新时间: <span id="footer-update-time">加载中...</span></p>
        </div>
    </footer>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-5 right-5 p-4 rounded-md shadow-lg transform translate-y-20 opacity-0 transition-all-300 hidden">
        <p id="notification-text" class="text-sm"></p>
    </div>

    <!-- 临时文本框（用于降级复制方案） -->
    <textarea id="temp-copy-area" style="position:absolute;top:-1000px;opacity:0;"></textarea>

    <script>
        // 当前日期处理
        const currentDate = new Date();
        document.getElementById('current-year').textContent = currentDate.getFullYear();
        
        // 格式化日期为YYYYMMDD
        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        };
        
        // 格式化显示日期
        const formatDisplayDate = (date) => {
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        };
        
        // 更新时间显示
        const updateTimeDisplay = () => {
            const now = new Date();
            const displayTime = formatDisplayDate(now);
            document.getElementById('last-update').innerHTML = 
                `<i class="fa fa-refresh mr-1"></i>最后更新: ${displayTime}`;
            document.getElementById('footer-update-time').textContent = displayTime;
        };
        
        // Clash URL模板列表
        const clashTemplates = [
            "https://node.freeclashnode.com/uploads/{year}/{month}/0-{date}.yaml",
            "https://node.freeclashnode.com/uploads/{year}/{month}/1-{date}.yaml",
            "https://node.freeclashnode.com/uploads/{year}/{month}/2-{date}.yaml",
            "https://node.freeclashnode.com/uploads/{year}/{month}/3-{date}.yaml",
            "https://node.freeclashnode.com/uploads/{year}/{month}/4-{date}.yaml",
            "http://mlfenx.cczzuu.top/node/{date}-clash.yaml",
            "http://clashshare.cczzuu.top/node/{date}-clash.yaml",
            "https://node.openclash.cc/uploads/{year}/{month}/0-{date}.yaml",
            "https://node.openclash.cc/uploads/{year}/{month}/1-{date}.yaml",
            "https://node.openclash.cc/uploads/{year}/{month}/2-{date}.yaml",
            "https://node.openclash.cc/uploads/{year}/{month}/3-{date}.yaml",
            "https://node.openclash.cc/uploads/{year}/{month}/4-{date}.yaml",
            "https://node.freeclashverge.com/uploads/{year}/{month}/0-{date}.yaml",
            "https://node.freeclashverge.com/uploads/{year}/{month}/1-{date}.yaml",
            "https://node.freeclashverge.com/uploads/{year}/{month}/2-{date}.yaml",
            "https://node.freeclashverge.com/uploads/{year}/{month}/4-{date}.yaml",
            "https://free.datiya.com/uploads/{date}-clash.yaml"
        ];
        
        // V2Ray URL模板列表
        const v2rayTemplates = [
            "https://node.freeclashnode.com/uploads/{year}/{month}/0-{date}.txt",
            "https://node.freeclashnode.com/uploads/{year}/{month}/1-{date}.txt",
            "https://node.freeclashnode.com/uploads/{year}/{month}/2-{date}.txt",
            "https://node.freeclashnode.com/uploads/{year}/{month}/3-{date}.txt",
            "https://node.freeclashnode.com/uploads/{year}/{month}/4-{date}.txt",
            "http://mlfenx.cczzuu.top/node/{date}-v2ray.txt",
            "http://clashshare.cczzuu.top/node/{date}-v2ray.txt",
            "https://node.openclash.cc/uploads/{year}/{month}/0-{date}.txt",
            "https://node.openclash.cc/uploads/{year}/{month}/1-{date}.txt",
            "https://node.freeclashverge.com/uploads/{year}/{month}/0-{date}.txt",
            "https://node.freeclashverge.com/uploads/{year}/{month}/1-{date}.txt",
            "https://node.freeclashverge.com/uploads/{year}/{month}/3-{date}.txt"
        ];
        
        // 生成当日URL列表
        const generateUrls = (templates) => {
            const dateStr = formatDate(currentDate);
            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            
            return templates.map(template => {
                return template.replace(/{year}/g, year)
                               .replace(/{month}/g, month)
                               .replace(/{date}/g, dateStr);
            });
        };
        
        // 显示URL列表
        const displayUrls = (urls, listId) => {
            const listElement = document.getElementById(listId);
            listElement.innerHTML = '';
            
            urls.forEach((url, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-start p-2 border border-gray-100 rounded hover:bg-gray-50 transition-all-300';
                li.innerHTML = `
                    <span class="text-gray-500 mr-3 mt-0.5">${index + 1}.</span>
                    <div class="flex-grow break-all select-all">${url}</div>
                    <button class="copy-single ml-2 text-gray-400 hover:text-primary transition-all-300" 
                            data-url="${url}" 
                            aria-label="复制此链接">
                        <i class="fa fa-copy"></i>
                    </button>
                `;
                listElement.appendChild(li);
            });
            
            // 添加单个URL复制功能
            document.querySelectorAll(`#${listId} .copy-single`).forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const url = e.currentTarget.getAttribute('data-url');
                    copyToClipboard(url);
                });
            });
        };
        
        // 复制到剪贴板（兼容优化版）
        const copyToClipboard = (text) => {
            // 方案1：现代浏览器Clipboard API（HTTPS环境）
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showNotification('复制成功！');
                    })
                    .catch(err => {
                        console.error('Clipboard API失败:', err);
                        // 失败时降级到方案2
                        fallbackCopy(text);
                    });
            } 
            // 方案2：降级方案（兼容HTTP和旧浏览器）
            else {
                fallbackCopy(text);
            }
        };
        
        // 降级复制方案：使用textarea和execCommand
        const fallbackCopy = (text) => {
            // 获取隐藏的临时文本框
            const tempArea = document.getElementById('temp-copy-area');
            tempArea.value = text;
            
            // 选中文本（适配移动端）
            tempArea.focus();
            tempArea.setSelectionRange(0, text.length);
            
            try {
                // 执行复制命令
                const success = document.execCommand('copy');
                if (success) {
                    showNotification('复制成功！');
                } else {
                    throw new Error('execCommand返回失败');
                }
            } catch (err) {
                console.error('降级复制失败:', err);
                // 引导用户手动复制
                showNotification('请长按文本手动复制', 'error');
                // 选中对应元素的文本，方便用户直接复制
                selectTextByValue(text);
            }
        };
        
        // 自动选中页面中对应的文本（辅助手动复制）
        const selectTextByValue = (text) => {
            const elements = document.querySelectorAll('.select-all');
            for (let el of elements) {
                if (el.textContent.trim() === text.trim()) {
                    const range = document.createRange();
                    range.selectNodeContents(el);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    break;
                }
            }
        };
        
        // 显示通知
        const showNotification = (message, type = 'success') => {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.className = `fixed bottom-5 right-5 p-4 rounded-md shadow-lg transform translate-y-0 opacity-100 transition-all-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            
            setTimeout(() => {
                notification.className = 'fixed bottom-5 right-5 p-4 rounded-md shadow-lg transform translate-y-20 opacity-0 transition-all-300';
            }, 3000);
        };
        
        // 显示状态提示
        const showStatus = (message, duration = 0) => {
            const alert = document.getElementById('status-alert');
            const messageEl = document.getElementById('status-message');
            
            messageEl.textContent = message;
            alert.classList.remove('hidden');
            
            if (duration > 0) {
                setTimeout(() => {
                    alert.classList.add('hidden');
                }, duration);
            }
        };
        
        // 初始化页面
        const init = () => {
            // 生成并显示Clash URL
            const clashUrls = generateUrls(clashTemplates);
            displayUrls(clashUrls, 'clash-list');
            
            // 生成并显示V2Ray URL
            const v2rayUrls = generateUrls(v2rayTemplates);
            displayUrls(v2rayUrls, 'v2ray-list');
            
            updateTimeDisplay();
            
            // 选项卡切换
            document.querySelectorAll('#tabs button').forEach(button => {
                button.addEventListener('click', () => {
                    // 移除所有选项卡的活跃状态
                    document.querySelectorAll('#tabs button').forEach(btn => {
                        btn.classList.remove('border-primary', 'text-primary');
                        btn.classList.add('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                    });
                    
                    // 添加当前选项卡的活跃状态
                    button.classList.remove('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
                    button.classList.add('border-primary', 'text-primary');
                    
                    // 隐藏所有内容
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.classList.add('hidden');
                    });
                    
                    // 显示当前内容
                    const tabId = button.getAttribute('data-tab');
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });
            
            // 复制所有Clash URL
            document.getElementById('copy-clash').addEventListener('click', () => {
                const urls = generateUrls(clashTemplates);
                copyToClipboard(urls.join('\n'));
            });
            
            // 复制所有V2Ray URL
            document.getElementById('copy-v2ray').addEventListener('click', () => {
                const urls = generateUrls(v2rayTemplates);
                copyToClipboard(urls.join('\n'));
            });
            
            // 刷新按钮
            document.getElementById('refresh-btn').addEventListener('click', () => {
                showStatus('正在刷新内容...');
                
                const clashUrls = generateUrls(clashTemplates);
                displayUrls(clashUrls, 'clash-list');
                
                const v2rayUrls = generateUrls(v2rayTemplates);
                displayUrls(v2rayUrls, 'v2ray-list');
                
                updateTimeDisplay();
                showStatus('内容已刷新', 2000);
            });
            
            // 检查浏览器环境并提示
            if (!window.isSecureContext && window.location.protocol !== 'https:') {
                showStatus('注意：非HTTPS环境下复制功能可能受限，建议使用手动复制', 5000);
            }
        };
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
    
